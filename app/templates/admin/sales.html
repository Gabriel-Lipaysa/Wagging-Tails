{% extends 'layout/admin.html' %}
{% block content %}
<div class="container no-print mb-4 p-3 bg-white shadow-sm">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <a href="?type=daily" class="btn btn-outline-dark btn-sm">Daily</a>
            <a href="?type=weekly" class="btn btn-outline-dark btn-sm">Weekly</a>
            <a href="?type=monthly" class="btn btn-outline-dark btn-sm">Monthly</a>
        </div>
        <button onclick="window.print()" class="btn btn-primary" >Save as PDF / Print</button>
    </div>  
</div>

<div class="container bg-white p-5 shadow">
    <div class="report-header d-flex justify-content-between align-items-center pb-3">
        <div>
            <h2 class="fw-bold" style="color: #5A604D;">Wagging Wonders</h2>
            <p class="text-muted mb-0">Sales Performance Document</p>
        </div>
        <div class="text-end">
            <h4 class="mb-0">{{ title }}</h4>
            <p class="small text-muted">Generated on: {{ now }}</p>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-4">
            <div class="stat-box">
                <small class="text-uppercase text-muted">Total Revenue</small>
                <h3 class="fw-bold">₱{{ "{:,.2f}".format(total_rev) }}</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-box">
                <small class="text-uppercase text-muted">Total Orders</small>
                <h3 class="fw-bold">{{ total_orders }}</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-box">
                <small class="text-uppercase text-muted">Average Sale</small>
                <h3 class="fw-bold">₱{{ "{:,.2f}".format(total_rev / total_orders if total_orders > 0 else 0) }}</h3>
            </div>
        </div>
    </div>

    <h5 class="fw-bold">Transaction Breakdown</h5>
    <table class="table table-striped mb-5">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Customer</th>
                <th>Payment</th>
                <th class="text-end">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.created_at.strftime('%Y-%m-%d') }}</td>
                <td>{{ order.customer_name }}</td>
                <td>{{ order.payment_method | upper }}</td>
                <td class="text-end">₱{{ "{:,.2f}".format(order.total_price) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h5 class="fw-bold">Top Performing Products</h5>
    <table class="table table-sm border">
        <thead class="table-dark">
            <tr>
                <th>Product Name</th>
                <th class="text-center">Quantity Sold</th>
                <th class="text-end">Total Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for prod in top_products %}
            <tr>
                <td>{{ prod.name }}</td>
                <td class="text-center">{{ prod.qty }}</td>
                <td class="text-end">₱{{ "{:,.2f}".format(prod.total_revenue) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}