{% extends 'layout/user.html' %}
{% from 'macros/card_macros.html' import product_card %}
{% block content %}

<div class="product-details-page" style="background: #ffffff; min-height: 100vh; padding: 3rem 0;">
    <div class="container">
        <div class="row g-5">
            <!-- Product Image Section -->
            <div class="col-lg-6">
                <div class="product-image-container position-relative">
                    {% if product.quantity == 0 %}
                        <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center"
                             style="background-color: rgba(0, 0, 0, 0.7); z-index: 2; border-radius: 20px;">
                            <h2 class="text-white fw-bold mb-0" style="font-size: 3rem;">
                                Out of Stock
                            </h2>
                        </div>
                    {% endif %}
                    <div class="product-image-wrapper-detail">
                        <img src="{{ url_for('static', filename=product.image) }}" 
                             class="product-main-image" 
                             alt="{{ product.name }}">
                    </div>
                {% endif %}
            </div>
            
            <div class="mb-5">
                <h5 class="fw-bold">Description</h5>
                <p class="text-muted">{{ product.description }}</p>
            </div>

        </div>

            <!-- Product Details Section -->
            <div class="col-lg-6">
                <div class="product-details-content">
                    <p class="product-brand mb-2">{{product.get('brand', 'Wagging Wonders').upper()}}</p>
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h1 class="product-title-detail">{{ product.name }}</h1>
                        <button class="btn btn-link p-0 wishlist-btn-detail" 
                                onclick="toggleWishlist({{ product.id }}, this)"
                                style="color: #dc3545;">
                            <i class="bi {{ 'bi-heart-fill' if product.is_wishlisted else 'bi-heart' }} fs-3 wishlist-heart"
                               data-product-id="{{ product.id }}"></i>
                        </button>
                    </div>
                    
                    <div class="product-price-section mb-4">
                        <span class="product-price-current">â‚±{{ "{:,.2f}".format(product.price) }}</span>
                    </div>
                    
                    <div class="product-availability mb-4">
                        {% if product.quantity == 0 %}
                            <div class="availability-badge unavailable">
                                <span class="availability-dot"></span>
                                <span>Out of Stock</span>
                            </div>
                        {% elif product.quantity <= 5 %}
                            <div class="availability-badge low-stock">
                                <span class="availability-dot"></span>
                                <span>Low Stock ({{ product.quantity }} left)</span>
                            </div>
                        {% else %}
                            <div class="availability-badge available">
                                <span class="availability-dot"></span>
                                <span>Available</span>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="product-description mb-4">
                        <p>{{ product.description or 'Made from high-quality, premium materials, this product provides excellent value for your pet. Designed with care and attention to detail.' }}</p>
                    </div>
                    
                    <div class="product-features mb-4">
                        <div class="feature-tags">
                            <span class="feature-tag">Premium Quality</span>
                            <span class="feature-tag">Pet Safe</span>
                        </div>
                    </div>
                    
                    <div class="product-actions-expanded mb-4">
                        <div class="add-to-cart-expanded">
                            <div class="cart-quantity-controls">
                                <button class="cart-quantity-btn" onclick="adjustPDPQuantity(-1)" {% if product.quantity == 0 %}disabled{% endif %}>
                                    <i class="bi bi-dash-lg"></i>
                                </button>
                                <input type="number" 
                                       id="pdp-quantity"
                                       class="cart-quantity-input"
                                       value="1"
                                       min="1"
                                       {% if product.quantity > 0 %}max="{{ product.quantity }}"{% else %}disabled{% endif %}
                                       readonly>
                                <button class="cart-quantity-btn" onclick="adjustPDPQuantity(1)" {% if product.quantity == 0 %}disabled{% endif %}>
                                    <i class="bi bi-plus-lg"></i>
                                </button>
                            </div>
                            <button id="pdp-add-to-cart" 
                                    class="btn-add-to-cart-expanded"
                                    onclick="{% if product.quantity > 0 %}addToCartFromPDP({{ product.id }}){% endif %}"
                                    {% if product.quantity == 0 %}disabled{% endif %}>
                                <i class="bi bi-cart-plus me-2"></i>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Related Products Section -->
        {% if related_products %}
        <div id="related-products" class="mt-5 pt-5" style="background: linear-gradient(135deg, #6a705d 0%, #5a604d 100%); padding: 3rem 2rem !important; border-radius: 20px;">
            <h3 class="fw-bold mb-4 text-white">Related Products</h3>
            <div class="row g-4"> 
                {% for p in related_products %}
                    <div class="col-md-3 col-sm-6">
                        {{ product_card(p) }}
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}